# =============================================================================
# Kustomization - Staging Overlay
# =============================================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: ai-inference-staging

namespace: ai-inference-staging

# Common labels for staging environment
commonLabels:
  environment: staging
  app.kubernetes.io/env: staging

# Common annotations
commonAnnotations:
  note: "Staging environment - mirrors production configuration"

# Base configuration
resources:
  - ../../base

# Patches for staging
patches:
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
    target:
      kind: Deployment
      name: ai-inference
  - patch: |-
      - op: replace
        path: /spec/minReplicas
        value: 2
      - op: replace
        path: /spec/maxReplicas
        value: 5
    target:
      kind: HorizontalPodAutoscaler
      name: ai-inference

# Image override for staging
images:
  - name: ai-inference
    newName: your-registry.com/ai-inference
    newTag: staging-latest

# ConfigMap for staging environment
configMapGenerator:
  - name: ai-inference-config
    behavior: create
    literals:
      - LOG_LEVEL=INFO
      - DEBUG=false
      - WORKERS=4
